<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­å­¦è‹±èªãƒã‚¹ã‚¿ãƒ¼ Webç‰ˆ</title>
    
    <script src="chapter01.js"></script>
    <script src="chapter13.js"></script>
    <script src="chapter14.js"></script>
    <script src="extra_chapter.js"></script>
    <script src="chapter15.js"></script>
    <script src="chapter73.js"></script>
    <script src="chapterSentencePatterns.js"></script>
    
    <style>
        /* ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®š (CSS) ä¿®æ­£ç‰ˆï¼šiPadå¯¾å¿œ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
            background-color: #f2f2f7;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh; /* é«˜ã•ã‚’å›ºå®šã›ãšã€æœ€ä½ã®é«˜ã•ã‚’æŒ‡å®š */
        }

        #app-container {
            width: 100%;
            max-width: 600px;
            background-color: white;
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«åˆã‚ã›ã¦ä¼¸ã³ã‚‹ã‚ˆã†ã« */
            position: relative;
            padding-bottom: 40px; /* ä¸‹ã«ä½™ç™½ã‚’ä½œã£ã¦ãƒœã‚¿ãƒ³éš ã‚Œã‚’é˜²æ­¢ */
            box-sizing: border-box;
        }

        /* ç”»é¢å…±é€š */
        .screen {
            display: none;
            flex-direction: column;
            /* height: 100%; ã‚’å‰Šé™¤ã—ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
            padding: 20px;
            box-sizing: border-box;
        }

        .active {
            display: flex;
        }

        /* ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ */
        .title-header { text-align: center; margin-top: 50px; margin-bottom: 30px; }
        .title-text { font-size: 32px; font-weight: bold; color: #007AFF; }
        .menu-list { flex: 1; padding-bottom: 20px; }
        .menu-btn {
            background-color: white; border: none; border-radius: 15px;
            padding: 20px; margin-bottom: 15px; width: 100%; text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.1s;
            border: 1px solid #eee; /* æ ç·šã‚’å°‘ã—è¿½åŠ  */
        }
        .menu-btn:active { transform: scale(0.98); }
        .menu-title { font-size: 18px; font-weight: bold; display: block; }
        .menu-sub { font-size: 14px; display: block; margin-top: 5px; opacity: 0.9; }

        /* ã‚¯ã‚¤ã‚ºç”»é¢ */
        .quiz-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .close-btn { background: #eee; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; color: #555; }
        .score-board { background: #eee; padding: 8px 12px; border-radius: 8px; font-weight: bold; }
        .progress-bar-bg { height: 6px; background: #e0e0e0; border-radius: 3px; margin-bottom: 20px; }
        .progress-bar-fill { height: 100%; background: #007AFF; border-radius: 3px; width: 0%; transition: width 0.3s; }

        .question-box {
            background: white; padding: 20px; border-radius: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center;
            margin-bottom: 20px; border: 1px solid #eee;
        }
        .q-text { font-size: 20px; font-weight: bold; margin-bottom: 10px; }
        .q-hint { font-size: 14px; color: #888; }

        /* æ–‡ä½œæˆã‚¨ãƒªã‚¢ */
        .sentence-area {
            min-height: 80px; background: #f9f9f9; border: 2px dashed #ccc;
            border-radius: 15px; display: flex; flex-wrap: wrap;
            align-items: center; justify-content: center; padding: 10px;
            margin-bottom: 20px; font-size: 20px; font-weight: bold; color: #333;
            gap: 8px; cursor: pointer;
        }
        .sentence-placeholder { color: #ccc; }

        /* å˜èªãƒãƒ³ã‚¯ */
        .word-bank {
            display: flex; flex-wrap: wrap; justify-content: center;
            gap: 10px; margin-bottom: 30px; /* ä¸‹ã«ä½™ç™½ã‚’è¿½åŠ  */
            align-content: start;
        }
        .word-chip {
            background: white; color: #007AFF; border: 1px solid #ddd;
            padding: 10px 15px; border-radius: 20px; font-weight: bold;
            font-size: 18px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; user-select: none;
        }
        .word-chip:active { background-color: #f0f0f0; }

        .check-btn {
            background-color: #007AFF; color: white; font-size: 18px; font-weight: bold;
            border: none; padding: 15px; border-radius: 15px; width: 100%; cursor: pointer;
            margin-top: 20px; /* è‡ªå‹•é…ç½®ã‚’ã‚„ã‚ã¦ä½™ç™½æŒ‡å®šã« */
        }
        .check-btn:disabled { background-color: #ccc; }

        /* çµæœã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆç”»é¢å›ºå®šï¼‰ */
        #feedback-overlay {
            position: fixed; /* absoluteã‹ã‚‰fixedã«å¤‰æ›´ */
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.2); display: none;
            justify-content: center; align-items: center; z-index: 100;
        }
        .feedback-box {
            background: white; padding: 30px; border-radius: 20px; text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2); width: 80%; max-width: 400px;
        }
        .feedback-icon { font-size: 60px; display: block; margin-bottom: 10px; }
        .feedback-text { font-size: 24px; font-weight: bold; display: block; margin-bottom: 10px; }
        .correct-answer-text { font-size: 16px; color: #555; background: #f0f0f0; padding: 10px; border-radius: 8px; }
        .c-green { color: #34C759; }
        .c-red { color: #FF3B30; }
    </style>
</head>
<body>

<div id="app-container">
    <div id="menu-screen" class="screen active">
        <div class="title-header">
            <div style="font-size: 60px;">ğŸ“–</div>
            <div class="title-text">ä¸­å­¦è‹±èªãƒã‚¹ã‚¿ãƒ¼</div>
        </div>
        <div class="menu-list">

            <button class="menu-btn" style="background: #FF9500; color: white;" onclick="tryStart(chapter01)">
                <span class="menu-title">chapterSentencePatterns</span>
                <span class="menu-sub">æ–‡æ³• (ä¸¦ã¹æ›¿ãˆ)</span>

             <button class="menu-btn" style="background: #FF9500; color: white;" onclick="tryStart(chapter00)">
                <span class="menu-title">Chapter00</span>
                <span class="menu-sub">éå»åˆ†è© (ä¸¦ã¹æ›¿ãˆ)</span>
            </button>
            
            <button class="menu-btn" style="background: #007AFF; color: white;" onclick="tryStart(chapter13)">
                <span class="menu-title">Chapter 13</span>
                <span class="menu-sub">ä»£åè© (He/She)</span>
            </button>

            <button class="menu-btn" style="background: #34C759; color: white;" onclick="tryStart(chapter14)">
                <span class="menu-title">Chapter 14</span>
                <span class="menu-sub">æ‰€æœ‰æ ¼ (My/Mine)</span>
            </button>

            <button class="menu-btn" style="background: #FF9500; color: white;" onclick="tryStart(extraChapter)">
                <span class="menu-title">Extra Chapter</span>
                <span class="menu-sub">a / the (ä¸¦ã¹æ›¿ãˆ)</span>
            </button>

            <button class="menu-btn" style="background: #AF52DE; color: white;" onclick="tryStart(chapter15)">
                <span class="menu-title">Chapter 15</span>
                <span class="menu-sub">éå»å½¢ (ä¸¦ã¹æ›¿ãˆ)</span>
            </button>
            
            <button class="menu-btn" style="background: #FF2D55; color: white;" onclick="tryStart(chapter73)">
                <span class="menu-title">Chapter 73</span>
                <span class="menu-sub">æ¥ç¶šè© (if / because)</span>
            </button>
            
        </div>
    </div>

    <div id="quiz-screen" class="screen">
        <div class="quiz-header">
            <button class="close-btn" onclick="quitGame()">âœ• ã‚„ã‚ã‚‹</button>
            <div class="score-board">
                <span style="color:#34C759">â—</span> <span id="score-correct">0</span>
                &nbsp;&nbsp;
                <span style="color:#FF3B30">âœ–</span> <span id="score-wrong">0</span>
            </div>
        </div>
        <div class="progress-bar-bg"><div id="progress-fill" class="progress-bar-fill"></div></div>
        <div class="question-box">
            <div id="q-text" class="q-text"></div>
            <div id="q-hint" class="q-hint"></div>
        </div>
        <div id="sentence-area" class="sentence-area" onclick="popLastWord()"></div>
        <div id="word-bank" class="word-bank"></div>
        <button id="check-btn" class="check-btn" onclick="checkAnswer()" disabled>æ±ºå®š</button>
    </div>

    <div id="result-screen" class="screen" style="justify-content: center; align-items: center; text-align: center;">
        <h1 style="font-size: 40px;">ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼</h1>
        <div style="display: flex; gap: 40px; margin: 30px 0;">
            <div><div style="color:#34C759">æ­£è§£</div><div id="final-correct" style="font-size: 50px; font-weight: bold;">0</div></div>
            <div><div style="color:#FF3B30">ä¸æ­£è§£</div><div id="final-wrong" style="font-size: 50px; font-weight: bold;">0</div></div>
        </div>
        <button class="menu-btn" style="background: #007AFF; color: white;" onclick="toMenu()">ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹</button>
    </div>

    <div id="feedback-overlay">
        <div class="feedback-box">
            <span id="fb-icon" class="feedback-icon"></span>
            <span id="fb-text" class="feedback-text"></span>
            <div id="fb-answer" class="correct-answer-text" style="display:none;"></div>
        </div>
    </div>
</div>

<script>
    // çŠ¶æ…‹ç®¡ç†
    let currentQuestions = [];
    let currentIndex = 0;
    let correctCount = 0;
    let wrongCount = 0;
    let selectedWords = [];
    let wordBank = [];

    // è¦ç´ å–å¾—
    const menuScreen = document.getElementById("menu-screen");
    const quizScreen = document.getElementById("quiz-screen");
    const resultScreen = document.getElementById("result-screen");
    const qText = document.getElementById("q-text");
    const qHint = document.getElementById("q-hint");
    const sentenceArea = document.getElementById("sentence-area");
    const wordBankArea = document.getElementById("word-bank");
    const checkBtn = document.getElementById("check-btn");
    const progressFill = document.getElementById("progress-fill");
    const scoreCorrect = document.getElementById("score-correct");
    const scoreWrong = document.getElementById("score-wrong");
    const feedbackOverlay = document.getElementById("feedback-overlay");
    const fbIcon = document.getElementById("fb-icon");
    const fbText = document.getElementById("fb-text");
    const fbAnswer = document.getElementById("fb-answer");

    // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ç¢ºèªä»˜ãã‚¹ã‚¿ãƒ¼ãƒˆ
    function tryStart(dataVariable) {
        if (typeof dataVariable === 'undefined') {
            alert("ã‚¨ãƒ©ãƒ¼: ã“ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚\nåŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã« 'chapterXX.js' ãŒã‚ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
        } else {
            startChapter(dataVariable);
        }
    }

    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function startChapter(data) {
        currentQuestions = [...data];
        currentIndex = 0;
        correctCount = 0;
        wrongCount = 0;
        scoreCorrect.innerText = 0;
        scoreWrong.innerText = 0;
        menuScreen.classList.remove("active");
        resultScreen.classList.remove("active");
        quizScreen.classList.add("active");
        loadQuestion();
    }

    function loadQuestion() {
        if (currentIndex >= currentQuestions.length) {
            showResult(); return;
        }
        const q = currentQuestions[currentIndex];
        qText.innerText = `Q${q.id}. ` + q.text;
        qHint.innerText = "ãƒ’ãƒ³ãƒˆ: " + q.hint;
        const pct = (currentIndex / currentQuestions.length) * 100;
        progressFill.style.width = pct + "%";
        selectedWords = [];
        wordBank = shuffle([...q.choices]);
        renderWords();
    }

    function renderWords() {
        sentenceArea.innerHTML = "";
        if (selectedWords.length === 0) {
            sentenceArea.innerHTML = '<span class="sentence-placeholder">å˜èªã‚’é¸ã‚“ã§æ–‡ã‚’ä½œã‚ã†</span>';
            checkBtn.disabled = true;
        } else {
            selectedWords.forEach((word) => {
                const span = document.createElement("span");
                span.innerText = word;
                sentenceArea.appendChild(span);
            });
            checkBtn.disabled = false;
        }
        wordBankArea.innerHTML = "";
        wordBank.forEach((word) => {
            const chip = document.createElement("div");
            chip.className = "word-chip";
            chip.innerText = word;
            chip.onclick = () => selectWord(word);
            wordBankArea.appendChild(chip);
        });
    }

    function selectWord(word) {
        selectedWords.push(word);
        const idx = wordBank.indexOf(word);
        if (idx > -1) wordBank.splice(idx, 1);
        renderWords();
    }

    function popLastWord() {
        if (selectedWords.length > 0) {
            const word = selectedWords.pop();
            wordBank.push(word);
            renderWords();
        }
    }

    function checkAnswer() {
        const q = currentQuestions[currentIndex];
        const userSentence = selectedWords.join(" "); // ã‚¹ãƒšãƒ¼ã‚¹ã§çµåˆ
        // ç°¡å˜ãªåˆ¤å®šï¼ˆå¤§æ–‡å­—å°æ–‡å­—ã‚„ã‚¹ãƒšãƒ¼ã‚¹ã‚’å³å¯†ã«ã™ã‚‹ãªã‚‰èª¿æ•´å¯ï¼‰
        const isCorrect = (userSentence.trim() === q.answer.trim());
        
        fbAnswer.style.display = "none";
        
        if (isCorrect) {
            correctCount++;
            scoreCorrect.innerText = correctCount;
            fbIcon.innerText = "â­•ï¸";
            fbIcon.className = "feedback-icon c-green";
            fbText.innerText = "æ­£è§£ï¼";
            fbText.className = "feedback-text c-green";
        } else {
            wrongCount++;
            scoreWrong.innerText = wrongCount;
            fbIcon.innerText = "âŒ";
            fbIcon.className = "feedback-icon c-red";
            fbText.innerText = "ä¸æ­£è§£...";
            fbText.className = "feedback-text c-red";
            
            // æ­£è§£ã‚’è¡¨ç¤º
            fbAnswer.innerText = "æ­£è§£: " + q.answer;
            fbAnswer.style.display = "block";
        }
        
        feedbackOverlay.style.display = "flex";
        
        setTimeout(() => {
            feedbackOverlay.style.display = "none";
            currentIndex++;
            loadQuestion();
        }, 2500); // 2.5ç§’å¾Œã«æ¬¡ã¸
    }

    function showResult() {
        quizScreen.classList.remove("active");
        resultScreen.classList.add("active");
        document.getElementById("final-correct").innerText = correctCount;
        document.getElementById("final-wrong").innerText = wrongCount;
    }

    function toMenu() {
        resultScreen.classList.remove("active");
        menuScreen.classList.add("active");
    }

    function quitGame() {
        if(confirm("ã‚¯ã‚¤ã‚ºã‚’ã‚„ã‚ã¦ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ")) {
            quizScreen.classList.remove("active");
            menuScreen.classList.add("active");
        }
    }
</script>

</body>
</html>
